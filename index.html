<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynmap 领地可视化</title>
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <div class="app-shell">
    <div class="map-container">
      <div id="map" aria-label="Dynmap 自定义底图"></div>
    </div>

    <aside class="control-panel" aria-label="数据管理面板">
      <div class="panel-header">
        <h1>Dynmap 数据控制台</h1>
        <p>在这里获取、查询和导出领地数据。</p>
      </div>

      <div class="button-grid">
        <button class="panel-button primary" onclick="refreshAllData()">🔄 获取最新数据</button>
        <button class="panel-button" onclick="viewStoredData()">👁️ 查看当前存储</button>
        <button class="panel-button" onclick="exportOverlayImage()">🖼️ 导出覆盖层图片</button>
        <button class="panel-button" onclick="showDatabaseStats()">📊 数据库统计</button>
        <button class="panel-button danger" onclick="clearStoredData()">🗑️ 清空存储</button>
      </div>

      <div id="storage-status" aria-live="polite"></div>
      <div id="status-content"></div>

      <div class="panel-section">
        <h2 id="data-display-title">📋 覆盖层数据</h2>

        <div class="data-toolbar" aria-label="覆盖层数据筛选与排序">
          <label class="data-toolbar__field">
            <span class="data-toolbar__label">覆盖层</span>
            <select id="overlay-dataset-select" class="data-toolbar__control">
              <option value="territoryMarkers">领地标记（点）</option>
              <option value="territoryAreas">领地区域（面）</option>
              <option value="countrySpawn">国家出生点（点）</option>
              <option value="countryAreas">国家区域（面）</option>
              <option value="countryCapitals">国家首都</option>
              <option value="countryCapitalsSpawn">首都出生点（点）</option>
            </select>
          </label>

          <label class="data-toolbar__field">
            <span class="data-toolbar__label">搜索</span>
            <input id="overlay-search" class="data-toolbar__control" type="search" placeholder="按名称 / ID / 国家搜索">
          </label>

          <div class="data-toolbar__row">
            <label class="data-toolbar__field">
              <span class="data-toolbar__label">排序</span>
              <select id="overlay-sort-field" class="data-toolbar__control">
                <option value="id">ID</option>
                <option value="name">城镇名称</option>
                <option value="countryName">国家名称</option>
                <option value="chunks">区块</option>
                <option value="townPlayers">城镇玩家数</option>
                <option value="countryPlayers">国家玩家数</option>
                <option value="size">面积/大小</option>
                <option value="territoryCount">领土数量</option>
              </select>
            </label>

            <label class="data-toolbar__field">
              <span class="data-toolbar__label">顺序</span>
              <select id="overlay-sort-direction" class="data-toolbar__control">
                <option value="asc">升序</option>
                <option value="desc">降序</option>
              </select>
            </label>
          </div>
        </div>

        <div id="data-list"></div>
      </div>
    </aside>
  </div>

  <script src="js/libs/leaflet.js"></script>
  <script src="js/libs/html2canvas.min.js"></script>
  <script src="js/libs/dexie.min.js"></script>
  <script src="js/data/indexeddb-manager.js"></script>
  <script src="js/data/desc-parsers.js"></script>
  <script src="js/data/data-domain.js"></script>
  <script src="js/data/data-country.js"></script>
  <script src="js/data/data-fetch.js"></script>
  <script src="js/data/data-overlay-datasets.js"></script>
  <script src="js/ui/overlay-list-controller.js"></script>
  <script src="js/data/data-ui.js"></script>
  <script src="js/data/data-manager.js"></script>
  <script src="js/map/overlay-manager.js"></script>
  <script src="js/map/overlay-export.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
